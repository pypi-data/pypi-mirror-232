(self.webpackChunkenergy_machines_jupyter_reports=self.webpackChunkenergy_machines_jupyter_reports||[]).push([[117],{2117:(e,t,n)=>{"use strict";n.r(t),n.d(t,{ManageTagsWidget:()=>ot,default:()=>it});var a=n(5923),s=n(5777),l=n(7423),c=n(1840),o=n(8832),i=n(6201),r=n(9546);const d=e=>e.replace(/(\.|\s|\/|-)/g,"_"),g="energy_machines_jupyter_reports",m=`${g}_accessToken`,h=`${g}_domain`,u=()=>localStorage.getItem(h);var p;!function(e){e.PERIOD="PERIOD",e.HISTORY_REQUEST="HISTORY_REQUEST"}(p||(p={}));const E=p,S="yyyy-MM-dd HH:mm:ss",C=({notebookModel:e,source:t,id:n})=>e.contentFactory.createCodeCell({cell:{cell_type:"code",source:t.join("\n"),metadata:{}},id:n}),L=(e,t,n)=>{const a=e.cells.iter();let s=a.next(),l=null,c=-1,o=0;for(;s;){if(s.id===n){l=s,c=o;break}s=a.next(),o++}if(l)e.cells.remove(c),e.cells.insert(c,t);else if(n===E.PERIOD)e.cells.insert(0,t);else{const n=e.cells.iter();let a=n.next(),s=0;for(;a;){if(a.id===E.PERIOD){s=1;break}a=n.next()}e.cells.insert(s,t)}};var _=n(6271),f=n.n(_),T=n(4456),v=n.n(T),k=n(1200),y=n(9034);const w="PROJECTS_LIST",I="TAGS_LIST",j=(0,y.createSlice)({name:"userSettings",initialState:{accessToken:"",domain:""},reducers:{setUserSettings(e,t){t.payload},setAccessToken(e,t){e.accessToken=t.payload},setDomain(e,t){e.domain=t.payload}}}),D=function(e){const t={model:null,isFetching:!1,hasBeenFetched:!1,isFetchingError:!1,needToInvalidate:!1,error:null};return(0,y.createSlice)({name:e,initialState:t,reducers:{fetchEntityStart(e){e.model=null,e.isFetching=!0,e.error=null,e.hasBeenFetched=!1,e.needToInvalidate=!1},fetchEntitySuccess(e,t){e.model=t.payload,e.isFetching=!1,e.error=null,e.hasBeenFetched=!0,e.needToInvalidate=!1},fetchEntityFailure(e,t){e.isFetching=!1,e.error=t.payload,e.hasBeenFetched=!0,e.needToInvalidate=!1}},extraReducers:{[j.actions.setAccessToken.type]:()=>t}})}(w);var F=n(7064);function N(e,t){const n={};return(0,y.createSlice)({name:e,initialState:n,reducers:{fetchEntityStart(e,n){(0,F.set)(e,t(n),{}),e[t(n)].model=null,e[t(n)].isFetching=!0,e[t(n)].error=null,e[t(n)].hasBeenFetched=!1,e[t(n)].needToInvalidate=!1},fetchEntitySuccess(e,n){e[t(n)].model=n.payload,e[t(n)].isFetching=!1,e[t(n)].error=null,e[t(n)].hasBeenFetched=!0,e[t(n)].needToInvalidate=!1},fetchEntityFailure(e,n){e[t(n)].isFetching=!1,e[t(n)].error=n.payload,e[t(n)].hasBeenFetched=!0,e[t(n)].needToInvalidate=!1}},extraReducers:{[j.actions.setAccessToken.type]:()=>n}})}const b=N(I,(e=>{const{args:t}=e.meta,[n]=t;return n})),P=N("PAGES_TREE",(e=>{const{args:t}=e.meta,[n]=t;return n})),$=e=>(0,y.createSlice)({name:e,initialState:{selectedIds:{},isAllSelected:!1,deselectedIds:{}},reducers:{setSelected(e,t){e.selectedIds=t.payload},setSelectAll(e,t){e.isAllSelected=t.payload,e.selectedIds={},e.deselectedIds={}},setDeselected(e,t){e.deselectedIds=t.payload}}}),R=$(I),O=$(w),x=$("PAGES_LIST"),A=Date.now(),B={startDate:A,endDate:A},M=(0,y.createSlice)({name:"dateRange",initialState:B,reducers:{setPeriod:(e,t)=>{e.startDate=t.payload.startDate,e.endDate=t.payload.endDate}}}),G=(0,y.combineReducers)({projectsList:D.reducer,tagsList:b.reducer,selectedTags:R.reducer,selectedProjects:O.reducer,selectedPages:x.reducer,dateRange:M.reducer,pagesTree:P.reducer,userSettings:j.reducer}),Z=(0,y.configureStore)({reducer:G});var z=n(9580),J=n.n(z),q=n(4497);function H({actions:e,fetchEntity:t,checkInCache:n,checkIsFetching:a,entityMapping:s=((e,...t)=>e)}){return(...l)=>async(c,o)=>{const i=o();if(!a(i,...l)&&!n(i,...l)){c({...e.fetchEntityStart(),meta:{args:l}});try{const n=await t(...l);c({...e.fetchEntitySuccess(s(n,...l)),meta:{args:l}})}catch(t){c({...e.fetchEntityFailure(t.toString()),meta:{args:l}})}}}}async function U(e){const t=localStorage.getItem(m),n=u();if(t&&n){const a=await fetch(`${n}/api/v1/${e}`,{method:"GET",headers:{"Content-Type":"application/json",Authorization:`Bearer ${t}`}}),s=await a.json();if(200===a?.status)return s;throw new Error(s.message)}throw(new Error).message="jupyterSettingsError"}const W=H({actions:D.actions,checkInCache:e=>!(0,F.isNil)(e.projectsList.model),fetchEntity:async function(){return U("projects/list")},checkIsFetching:e=>e.projectsList.isFetching,entityMapping:e=>(0,F.sortBy)(e,(e=>e.name.toLocaleLowerCase()))}),K=H({actions:b.actions,checkInCache:(e,t)=>!(0,F.isNil)((0,F.get)(e,["tagsList",t,"model"])),fetchEntity:async e=>async function(e){return U(`${e}/tag/list`)}(e),checkIsFetching:(e,t)=>(0,F.get)(e,["tagsList",t,"isFetching"],!1),entityMapping:(e,t)=>e.map((e=>({...e,id:e.id+t,projectId:t,tagId:e.id})))});var Q=n(2962);const V=(e="")=>new RegExp(""+e.replace(/\\/g,"\\\\").replace(/\./g,"\\.").replace(/\?/g,".").replace(/\*+/g,".*"),"i"),Y=(e,t)=>!t||!e||(t.startsWith("!")?!t.slice(1)||!e.match(V(t.slice(1))):!!e.match(V(t))),X=()=>(0,Q.createSelector)((e=>e.projectsList.model),((e,t)=>t),((e,t)=>{let n=[];if(e)if(t){const a=t.toLocaleLowerCase();n=e.filter((e=>Y(e.name,a)))}else n=e;return n})),ee=(X(),(0,Q.createSelectorCreator)(Q.defaultMemoize,F.isEqual)(((e,{projectsIds:t})=>{const n=[];return t.forEach((t=>{const a=(0,F.get)(e.tagsList,[t,"model"]);a&&n.push(...a)})),n}),((e,{query:t})=>t.toLowerCase()),((e,{projectsIds:t})=>{const n={},a=e.projectsList.model;return t.forEach((e=>{n[e]=(0,F.find)(a,{id:e})})),n}),((e,t,n)=>{const a=[];return e.forEach((e=>{Y(e.path,t)&&e.path&&a.push({...e,projectName:n[e.projectId].name})})),a})));var te=n(5223),ne=n.n(te);ne().defaultStyles.overlay.backgroundColor="var(--jp-dialog-background)";const ae="jp-hmi-modal",se=e=>{const{title:t,className:n,children:a,renderButtons:s,fullScreen:l,...c}=e;return f().createElement(ne(),Object.assign({ariaHideApp:!1,className:J()(`${ae}__dialog`,n,{[`${ae}__dialog_fullscreen`]:l})},c),f().createElement("div",{className:`${ae}__content`},t?"string"==typeof t?f().createElement("span",{className:`${ae}__title`},t):t():null,f().createElement("div",{className:`${ae}__body`},a),s?f().createElement("div",{className:`${ae}__buttons`},s()):null))};se.defaultProps={isOpen:!0};const le=se;var ce=n(7497);const oe=e=>{const{onFilter:t,placeholder:n,className:a,delay:s=100}=e,[l,c]=(0,_.useState)("");(0,ce.useDebounce)((()=>{t&&t(l)}),s,[t,l]);const o=(0,_.useCallback)((e=>{c(e.target.value)}),[c]);return f().createElement(q.InputGroup,{value:l,onChange:o,placeholder:n,className:J()("jp-hmi-filter",a)})};var ie=n(2510);const re="jp-hmi-table",de=e=>{const{className:t,isSelectAllChecked:n,numberOfSelectedItems:a,allItemsSelectedText:s,noItemsSelectedText:l,selectedItemsText:c,children:o,rowClassName:i,onItemChange:r,isItemChecked:d,onSelectAllChange:g,noDataText:m,isFetchingData:h,placeholder:u,...p}=e,E=(0,_.useMemo)((()=>{if(h)return null;let e;return e=a?n?s:c:l,f().createElement("div",{className:J()(`${re}__selected-container`,{[`${re}__selected-container_with-selected-items`]:n||!!a})},e)}),[s,n,l,a,c,h]),S=(0,_.useCallback)((()=>f().createElement(q.Checkbox,{className:`${re}__checkbox`,checked:n,onChange:()=>g(n)})),[n,g]),C=(0,_.useCallback)((()=>f().createElement("div",{className:`${re}__no-data-text`},m)),[m]),L=(0,_.useCallback)((e=>f().createElement(q.Checkbox,{className:`${re}__checkbox`,checked:d(e.rowData),onChange:t=>{r(t.target.checked,e.rowData)}})),[d,r]);return f().createElement("div",{className:J()(re,t)},h?f().createElement("div",{className:`${re}__placeholder`},u):E,h?null:f().createElement("div",{className:`${re}__auto-sizer`},f().createElement(ie.AutoSizer,null,(({width:e,height:t})=>f().createElement(ie.Table,Object.assign({className:`${re}__table`},p,{noRowsRenderer:C,width:e,height:t,rowClassName:J()(`${re}__row`,i)}),f().createElement(ie.Column,{width:26,dataKey:"id",headerRenderer:S,cellRenderer:L}),o)))))};function ge({actions:e,entities:t=[],getSelectedEntitiesSelector:n,onCheckedEntitiesChange:a}){const s=(0,k.useDispatch)(),{isAllSelected:l,selectedIds:c,deselectedIds:o}=(0,k.useSelector)((e=>n(e)));return{onSelectAllChange:(0,_.useCallback)((t=>{s(e.setSelectAll(!t))}),[e,s]),onSelectEntityChange:(0,_.useCallback)(((t,n)=>{const a={...c},i={...o};l?(t?delete i[n.id]:i[n.id]=n.id,s(e.setDeselected(i))):(t?a[n.id]=n.id:delete a[n.id],s(e.setSelected(a)))}),[e,o,s,l,c]),checkIsChecked:(0,_.useCallback)((e=>l?!(e.id in o):e.id in c),[l,c,o]),isAllSelected:(0,_.useMemo)((()=>!!t.length&&(l?t.every((e=>!(e.id in o))):t.reduce(((e,t)=>e&&t.id in c),!0))),[c,l,t,o]),selectedEntities:(0,_.useMemo)((()=>{let e;return e=l?t.filter((e=>!(e.id in o))):t.filter((e=>e.id in c)),a(e),e}),[l,a,t,o,c])}}const me=e=>{const{className:t,projects:n,setSelectedProjects:a,isFetchingData:s}=e,{onSelectAllChange:l,onSelectEntityChange:c,checkIsChecked:o,isAllSelected:i,selectedEntities:r}=ge({entities:n||[],actions:O.actions,getSelectedEntitiesSelector:e=>e.selectedProjects,onCheckedEntitiesChange:a}),d=(0,_.useMemo)((()=>`${r.length} projects selected`),[r]),g=(0,_.useCallback)((({index:e})=>n[e]),[n]);return f().createElement(de,{className:t,numberOfSelectedItems:r.length,allItemsSelectedText:"All projects selected",noItemsSelectedText:"No projects selected",placeholder:"Fetching projects...",noDataText:"No projects found",selectedItemsText:d,isItemChecked:o,onItemChange:c,onSelectAllChange:l,isSelectAllChecked:i,isFetchingData:s,rowHeight:34,rowCount:n.length,rowGetter:g,headerHeight:40,height:300,width:300},f().createElement(ie.Column,{label:"Project name",dataKey:"name",flexGrow:1,flexShrink:0,width:1}))},he="jp-hmi-select-tags-table",ue=e=>{const{tags:t,setSelectedTags:n,className:a}=e,{onSelectAllChange:s,onSelectEntityChange:l,checkIsChecked:c,isAllSelected:o,selectedEntities:i}=ge({entities:t||[],actions:R.actions,getSelectedEntitiesSelector:e=>e.selectedTags,onCheckedEntitiesChange:n}),r=(0,_.useMemo)((()=>`${i.length} tags selected`),[i]),d=(0,_.useCallback)((({index:e})=>t[e]),[t]);return f().createElement(de,{className:a,numberOfSelectedItems:i.length,allItemsSelectedText:"All tags selected",noItemsSelectedText:"No tags selected",noDataText:"No tags found",placeholder:"Fetching tags",selectedItemsText:r,isItemChecked:c,onItemChange:l,onSelectAllChange:s,isSelectAllChecked:o,rowHeight:34,rowCount:t.length,rowGetter:d,headerHeight:40,height:300,width:300},f().createElement(ie.Column,{className:`${he}__cell`,label:"Tag name",dataKey:"name",width:1,flexGrow:1}),f().createElement(ie.Column,{className:`${he}__cell ${he}__cell_location`,label:"Location",dataKey:"path",width:1,flexGrow:2}),f().createElement(ie.Column,{className:`${he}__cell ${he}__cell_project-name`,label:"Project name",dataKey:"projectName",width:100,flexShrink:0}))};var pe;!function(e){e.JupyterSettingsError="jupyter.settings.error",e.IncorrectCredentials="CredentialsNotConfigured"}(pe||(pe={}));const Ee=pe,Se=e=>{const{error:t}=e;return t===Ee.JupyterSettingsError?f().createElement("div",{className:"error-message"},f().createElement("p",{className:"error-highlight"},"AccessToken or domain is not defined."),f().createElement("p",null,"Please go to settings ",f().createElement("span",null,"ctrl+,")," and define the values")):t===Ee.IncorrectCredentials?f().createElement("div",{className:"error-message"},f().createElement("p",{className:"error-highlight"},"AccessToken or domain is incorrect."),f().createElement("p",null,"Please go to settings ",f().createElement("span",null,"ctrl+,")," and correct the values")):f().createElement("div",{className:"error-message"},f().createElement("p",null,t))},Ce="jp-hmi-select-tags-from-list",Le=`${Ce}__button`;var _e;!function(e){e[e.SELECT_PROJECTS=0]="SELECT_PROJECTS",e[e.SELECT_TAGS=1]="SELECT_TAGS"}(_e||(_e={}));const fe=X(),Te=e=>{const{onRequestClose:t,isOpen:n,onFinishButtonClick:a}=e,[s,l]=(0,_.useState)([]),[c,o]=(0,_.useState)([]),[i,r]=(0,_.useState)(""),[d,g]=(0,_.useState)(_e.SELECT_PROJECTS),m=(0,k.useDispatch)();(0,_.useEffect)((()=>{n&&m(W())}),[m,n]);const h=(0,k.useSelector)((e=>e.projectsList.model)),u=(0,k.useSelector)((e=>e.projectsList.error)),p=(0,k.useSelector)((e=>fe(e,i))),E=(0,k.useSelector)((e=>ee(e,{projectsIds:s.map((e=>e.id)),query:i}))),S=(0,k.useSelector)((e=>!e.projectsList.hasBeenFetched)),C=(0,_.useCallback)((()=>{const e=d===_e.SELECT_PROJECTS?"Select projects from table":"Select tags from table";return f().createElement("div",{className:`${Ce}__title-container`},f().createElement("div",{className:"jp-hmi-modal__title"},e),f().createElement(oe,{key:d,placeholder:d===_e.SELECT_PROJECTS?"Filter projects by name":"Filter by tag path",onFilter:r}))}),[d]),L=(0,_.useCallback)((()=>{g(_e.SELECT_TAGS),r(""),s.forEach((e=>{m(K(e.id))}))}),[m,s]),T=(0,k.useSelector)((e=>!s.reduce(((t,n)=>t&&(0,F.get)(e,["tagsList",n.id,"hasBeenFetched"],!1)),!0))),v=(0,_.useCallback)((()=>d===_e.SELECT_PROJECTS?f().createElement(f().Fragment,null,f().createElement(q.Button,{className:J()(Le,`${Le}_cancel`),onClick:t},"Cancel"),f().createElement(q.Button,{className:J()(Le,`${Le}_cancel`),intent:"primary",disabled:!s.length,onClick:L},"Next")):f().createElement(f().Fragment,null,f().createElement(q.Button,{className:J()(Le,`${Le}_cancel`),onClick:t},"Cancel"),f().createElement(q.Button,{className:J()(Le),intent:"primary",disabled:T||!c.length,onClick:()=>{const e=(0,F.groupBy)(c,"projectId"),t=Object.keys(e),n=[];t.forEach((t=>{n.push((0,F.find)(h,{id:t})),e[t]=(0,F.values)(e[t]).map((e=>e.path))})),r(""),g(_e.SELECT_PROJECTS),a({tags:e,projects:n})}},"Finish"))),[T,a,L,t,h,s.length,c,d]);return f().createElement(le,{title:C,isOpen:n,className:Ce,onRequestClose:t,renderButtons:v},d===_e.SELECT_PROJECTS?u?f().createElement(Se,{error:u}):f().createElement(me,{isFetchingData:S,className:`${Ce}__table`,projects:p,setSelectedProjects:l}):f().createElement(ue,{isFetchingData:T,className:`${Ce}__table`,tags:E,setSelectedTags:o}))};var ve=n(9077),ke=n(3894);const ye=(0,Q.createSelector)((e=>e.dateRange),(e=>[{startDate:new Date(e.startDate),endDate:new Date(e.endDate)}])),we=e=>{const t=(0,k.useSelector)((e=>ye(e))),n=(0,k.useDispatch)(),{isOpen:a,onRequestClose:s,onDateRangeChange:l}=e,c=(0,_.useCallback)((()=>f().createElement(f().Fragment,null,f().createElement(q.Button,{onClick:s},"Close"),f().createElement(q.Button,{intent:"primary",onClick:()=>{const[e]=t;l(e)}},"Ok"))),[l,s,t]),o=(0,_.useCallback)((e=>{n(M.actions.setPeriod({startDate:e.range1.startDate.valueOf(),endDate:(0,ke.default)(e.range1.endDate).valueOf()}))}),[n]);return f().createElement(le,{isOpen:a,title:"Select period for report",onRequestClose:s,renderButtons:c},f().createElement(ve.DateRangePicker,{onChange:o,showPreview:!0,moveRangeOnFirstSelection:!1,months:2,ranges:t,direction:"horizontal"}),";")};var Ie=n(2234),je=n.n(Ie),De=n(7370);const Fe=e=>{const{isFetchingData:t,placeholder:n,className:a,items:s,itemSize:l,selectedItemId:c,onSelectedItemChange:o,noRowsText:i,...r}=e,d=e=>{const{style:t,data:n,index:a}=e,s=n[a];return f().createElement("div",{className:J()("jp-hmi-select-items-list__item",{"jp-hmi-select-items-list__item_active":c===s.id}),style:t,onClick:()=>{c!==s.id&&o(s)}},s.name)};return f().createElement("div",{className:J()("jp-hmi-select-items-list",a)},t?f().createElement("div",{className:"jp-hmi-select-items-list__placeholder"},n):f().createElement(je(),{className:"jp-hmi-select-items-list__auto-sizer-container"},(({height:e,width:t})=>s.length?f().createElement(De.FixedSizeList,Object.assign({itemData:s,width:t,height:e,itemCount:s.length,itemSize:l},r),d):f().createElement("div",{style:{width:t,height:e},className:"jp-hmi-select-items-list__list_empty"},i))))};Fe.defaultProps={placeholder:"",items:[],isFetchingData:!1,noRowsText:"No items found"};const Ne=Fe,be=e=>({...e,path:"",children:e.children.map(be)}),Pe=H({actions:P.actions,checkInCache:(e,t)=>!(0,F.isNil)((0,F.get)(e,["pagesTree",t,"model"])),fetchEntity:async e=>async function(e){return U(`${e}/page/tree`)}(e),checkIsFetching:(e,t)=>(0,F.get)(e,["pagesTree",t,"isFetching"],!1),entityMapping:e=>{const t=be(e),n=[],a=[t];for(;a.length;){const e=a.pop();for(e.children=(0,F.sortBy)((0,F.get)(e,"children",[]),(e=>e.type),(e=>e.name.toLowerCase()));n.length&&(0,F.last)(n).id!==e.parentId;)n.pop();const t=n.slice(1).map((e=>e.name)).join("/");e.path=""===t?e.name:`${t}/${e.name}`,(0,F.get)(e,["children","length"],0)&&n.push(e),a.push(...e.children)}return t}});var $e;!function(e){e.Root="PAGES_ROOT",e.Folder="FOLDER",e.Page="PAGE"}($e||($e={}));const Re=$e,Oe=(0,Q.createSelector)(((e,{projectId:t})=>(0,F.get)(e,["pagesTree",t,"model"],null)),((e,{query:t})=>t),((e,t)=>{if(!e)return null;if(""===t)return e;const n=[e],a={...e,children:[]},s=[a],l=[];for(;n.length;){const e=n.pop(),a=s.pop();for(;l.length&&(0,F.last)(l).id!==e.parentId;)l.pop();if(e.children.length&&l.push(a),e.children.forEach((e=>{e.type===Re.Folder?e.children.length&&(n.push(e),a.children.push({...e,children:[]})):Y(e.path,t)&&(n.push(e),a.children.push({...e,children:[]}))})),a.type===Re.Folder&&!a.children.length){let e=a;for(let t=l.length-1;t>=0&&(l[t].children=l[t].children.filter((t=>t!==e)),!l[t].children.length);t--)e=l[t]}s.push(...a.children)}return a}));var xe=n(1096);const Ae=new q.LabIcon({name:"hmi_manager:folderOpenned",svgstr:'<svg viewBox="0 0 24 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <path class=\'jp-icon3\' fill="none" d="M20,6 L12,6 L10,4 L4,4 C2.9,4 2.01,4.9 2.01,6 L2,18 C2,19.1 2.9,20 4,20 L20,20 C21.1,20 22,19.1 22,18 L22,8 C22,6.9 21.1,6 20,6 Z M20,18 L4,18 L4,8 L20,8 L20,18 Z"\n          fill-rule="nonzero"></path>\n</svg>\n'}),Be=new q.LabIcon({name:"hmi_manager:folder",svgstr:"<svg viewBox='0 0 24 24' version='1.1' xmlns='http://www.w3.org/2000/svg'>\n    <path class='jp-icon3' fill=\"none\" d='M10,4 L4,4 C2.9,4 2.01,4.9 2.01,6 L2,18 C2,19.1 2.9,20 4,20 L20,20 C21.1,20 22,19.1 22,18 L22,8 C22,6.9 21.1,6 20,6 L12,6 L10,4 Z'\n          fill-rule='nonzero'></path>\n</svg>\n"}),Me=new q.LabIcon({name:"hmi_manager:page",svgstr:'<svg viewBox="0 0 24 24"  version="1.1" xmlns="http://www.w3.org/2000/svg">\n    <path class=\'jp-icon3\' fill="none" d="M4,6.07070707 L20,6.07070707 L20,20 L4,20 L4,6.07070707 Z M4.25,3 C3.0073125,3 2,4.12585556 2,5.51475556 L2,19.4853148 C2,20.8741444 3.0073125,22 4.25,22 L19.75,22 C20.9926875,22 22,20.8741444 22,19.4853148 L22,5.51475556 C22,4.12585556 20.9926875,3 19.75,3 L4.25,3 Z M15.4,17.5293704 L15.4,18.647063 L17.4,18.647063 L17.4,17.5293704 L15.4,17.5293704 Z M7.5,8.58825185 L7.5,9.70587407 L8.6,9.70587407 L8.6,8.58825185 L7.5,8.58825185 Z M5.3,8.58825185 L5.3,9.70587407 L6.4,9.70587407 L6.4,8.58825185 L5.3,8.58825185 Z M15.4,15.2941963 L15.4,16.4118185 L18.4,16.4118185 L18.4,15.2941963 L15.4,15.2941963 Z M6.7,15.2941963 L6.7,17.5293704 L8.7,17.5293704 L8.7,15.2941963 L6.7,15.2941963 Z M5.3,10.8235667 L5.3,14.1765037 L9.8,14.1765037 L9.8,10.8235667 L5.3,10.8235667 Z M9.8,15.2941963 L9.8,18.647063 L14,18.647063 L14,15.2941963 L9.8,15.2941963 Z M15.4,9.70587407 L17.6,9.70587407 L17.6,11.9411889 L15.4,11.9411889 L15.4,9.70587407 Z M10.9,8.58825185 L10.9,14.1765037 L18.5,14.1765037 L18.5,8.58825185 L10.9,8.58825185 Z"\n          fill-rule="nonzero"></path>\n</svg>\n'}),Ge="select-item-tree",Ze=({data:{isLeaf:e,path:t,nestingLevel:n,id:a,selected:s,onSelectedItemChange:l},isOpen:c,style:o,toggle:i})=>f().createElement("div",{style:{...o,marginLeft:30*n},className:J()(`${Ge}__item`,{[`${Ge}__item_folder`]:!e,[`${Ge}__item_selected`]:s}),onClick:e?()=>{l(a)}:i},e?null:f().createElement("div",{className:J()(`${Ge}__arrow`,{[`${Ge}__arrow_expanded`]:c})}),!e&&(c?f().createElement(Ae.react,{className:`${Ge}__folder-icon`}):f().createElement(Be.react,{className:`${Ge}__folder-icon`})),f().createElement("div",{className:`${Ge}__item-info`},e?f().createElement(Me.react,{className:`${Ge}__item-icon`}):null,f().createElement("span",null,t))),ze=e=>{const{isFetchingData:t,className:n,placeholderText:a,tree:s,itemSize:l,selectedItemId:c,noDataText:o,expandItems:i,onSelectedItemChange:r}=e,d=(0,_.useRef)(null);(0,_.useEffect)((()=>{d.current?.recomputeTree({useDefaultOpenness:!0})}),[d.current]);const g=(0,_.useCallback)((function*(e){const t=[];for(let e=s.length-1;e>=0;e--)t.push({nestingLevel:0,node:s[e]});for(;0!==t.length;){const{node:{children:n=[],id:a,name:s,type:l},nestingLevel:o}=t.pop(),d=yield e||i?{id:a,isLeaf:l===Re.Page,isOpenByDefault:i,selected:c===a,name:s,path:s,nestingLevel:o,onSelectedItemChange:r}:a;if(0!==n.length&&d)for(let e=n.length-1;e>=0;e--)t.push({nestingLevel:o+1,node:n[e]})}}),[s,c,r,i]);return f().createElement("div",{className:J()(Ge,n)},f().createElement(je(),{className:`${Ge}__autosizer`},(({width:e,height:n})=>t?f().createElement("div",{style:{width:e,height:n},className:`${Ge}__placeholder`},a):s.length?f().createElement(xe.FixedSizeTree,{ref:d,treeWalker:g,itemSize:l,height:n,width:e},Ze):f().createElement("div",{style:{width:e,height:n},className:`${Ge}__placeholder`},o))))},Je=e=>{const{projectId:t,onSelectedPageChange:n,query:a}=e,s=(0,k.useDispatch)(),[l,c]=(0,_.useState)(),o=(0,k.useSelector)((e=>Oe(e,{projectId:t,query:a}))),i=(0,k.useSelector)((e=>!(0,F.get)(e,["pagesTree",t,"hasBeenFetched"],!1)));(0,_.useEffect)((()=>{s(Pe(t))}),[t,s]),(0,_.useEffect)((()=>{n(l)}),[n,l]);const r=(0,_.useCallback)((e=>{c(e)}),[]);return f().createElement(ze,{itemSize:40,isFetchingData:i,placeholderText:"Fetching pages",noDataText:"No pages found",selectedItemId:l,tree:(0,F.get)(o,"children",[]),onSelectedItemChange:r,expandItems:!!a})},qe=({pageId:e,projectId:t,token:n,domain:a,onSelectionChanged:s})=>{const l=(0,_.useRef)(null);(0,ce.useEffectOnce)((()=>(window.addEventListener("message",c),()=>{window.removeEventListener("message",c)})));const c=(0,_.useCallback)((e=>{if("string"==typeof e.data)try{const t=JSON.parse(e.data);"tagsChanged"===t.type&&s&&s(t.tags)}catch(e){}}),[s]);return f().createElement("div",{className:"jp-hmi-dashboard"},f().createElement("iframe",{ref:l,src:`${a}/shared/${n}/projects/${t}/pages/${e}`}))};var He;!function(e){e[e.SELECT_PROJECT=0]="SELECT_PROJECT",e[e.SELECT_PAGE=1]="SELECT_PAGE",e[e.SELECT_TAGS=2]="SELECT_TAGS"}(He||(He={}));const Ue=X(),We="jp-hmi-select-tags-from-page__button",Ke=({children:e})=>f().createElement("div",{className:"jp-hmi-select-tags-from-page__title-container"},e),Qe=e=>{const{onRequestClose:t,isOpen:n,onFinish:a}=e,s=(0,k.useDispatch)(),[l,c]=(0,_.useState)(""),[o,i]=(0,_.useState)(He.SELECT_PROJECT),[r,d]=(0,_.useState)([]),g=(0,_.useCallback)((e=>{s(O.actions.setSelected(e?{[e]:e}:{}))}),[s]),m=(0,_.useCallback)((e=>{s(x.actions.setSelected(e?[e]:[]))}),[s]),h=(0,k.useSelector)((e=>Object.values(e.selectedProjects.selectedIds)[0])),u=(0,k.useSelector)((e=>Object.values(e.selectedPages.selectedIds)[0])),p=(0,k.useSelector)((e=>Ue(e,l))),E=(0,k.useSelector)((e=>Ue(e,""))),S=(0,k.useSelector)((e=>e.userSettings.accessToken)),C=(0,k.useSelector)((e=>e.projectsList.error)),L=(0,k.useSelector)((e=>e.userSettings.domain));(0,_.useEffect)((()=>{n&&o===He.SELECT_PROJECT&&s(W())}),[s,n,o]),(0,_.useEffect)((()=>{n&&o===He.SELECT_PROJECT&&!p.find((e=>e.id===h))&&(p&&p.length?g(p[0].id):p&&!p.length&&g(void 0))}),[p,l,h,g,o,n]);const T=(0,k.useSelector)((e=>!e.projectsList.hasBeenFetched)),v=(0,k.useSelector)((e=>e.projectsList.model)),y=()=>{o===He.SELECT_PROJECT&&i(He.SELECT_PAGE),o===He.SELECT_PAGE&&i(He.SELECT_TAGS),c("")},w=()=>{o===He.SELECT_PAGE&&i(He.SELECT_PROJECT),o===He.SELECT_TAGS&&i(He.SELECT_PAGE),c("")},I=e=>{const n=(0,F.groupBy)(r,"projectId"),s=Object.keys(n),l=[];s.forEach((e=>{l.push((0,F.find)(v,{id:e})),n[e]=(0,F.values)(n[e]).map((e=>e.path))})),a({projects:l,tags:n}),t(e)},j=(0,_.useCallback)((e=>{g(e.id)}),[g]),D=(0,_.useCallback)((e=>{m(e)}),[m]);return f().createElement(le,{title:()=>{if(o===He.SELECT_PROJECT)return f().createElement(Ke,null,f().createElement(f().Fragment,null,f().createElement("div",{className:"jp-hmi-modal__title"},"Select project from list"),f().createElement(oe,{key:o,placeholder:"Filter by project name",onFilter:c})));if(o===He.SELECT_PAGE){const e=(0,F.find)(E||[],{id:h})||null;return f().createElement(Ke,null,f().createElement(f().Fragment,null,f().createElement("div",{className:"jp-hmi-modal__title"},"Select page on ",(0,F.get)(e,"name","")),f().createElement(oe,{key:o,placeholder:"Filter by page path",onFilter:c})))}return o===He.SELECT_TAGS?f().createElement("div",{className:"jp-hmi-modal__title"},"Select tags on page"):null},isOpen:n,renderButtons:()=>o===He.SELECT_TAGS?f().createElement(f().Fragment,null,f().createElement(q.Button,{className:J()(We,`${We}_cancel`),onClick:t},"Cancel"),f().createElement(q.Button,{className:J()(We,`${We}_prev`),intent:"primary",onClick:w},"Prev"),f().createElement(q.Button,{className:J()(We,`${We}_next`),intent:"primary",onClick:I},"Finish")):o===He.SELECT_PROJECT?f().createElement(f().Fragment,null,f().createElement(q.Button,{className:J()(We,`${We}_cancel`),onClick:t},"Cancel"),f().createElement(q.Button,{className:J()(We,`${We}_next`),intent:"primary",disabled:!h,onClick:y},"Next")):f().createElement(f().Fragment,null,f().createElement(q.Button,{className:J()(We,`${We}_cancel`),onClick:t},"Cancel"),f().createElement(q.Button,{className:J()(We,`${We}_cancel`),onClick:w},"Select project"),f().createElement(q.Button,{className:J()(We,`${We}_next`),intent:"primary",disabled:!u,onClick:y},"Next")),fullScreen:o===He.SELECT_TAGS},C?f().createElement(Se,{error:C}):o===He.SELECT_PROJECT?f().createElement(Ne,{itemSize:40,isFetchingData:T,items:p,selectedItemId:h,placeholder:"Fetching projects...",noRowsText:"No projects found",onSelectedItemChange:j}):o===He.SELECT_PAGE?f().createElement(Je,{projectId:h,onSelectedPageChange:D,query:l}):o===He.SELECT_TAGS?f().createElement(qe,{onSelectionChanged:e=>{d(e)},pageId:u,projectId:h,token:S,domain:L}):null)},Ve=({userSettings:e,children:t})=>{const n=(0,k.useDispatch)();let a=null,s=null;return e&&(a=e.accessToken),e&&(s=e.domain),(0,_.useEffect)((()=>{var e;null!==a&&(e=a,localStorage.setItem(m,e),n(j.actions.setAccessToken(a))),null!==s&&((e=>{localStorage.setItem(h,e)})(s),n(j.actions.setDomain(s)))}),[n,a,s]),t},Ye=e=>{const{userSettings:t,onCloseSelectTagsFromListDialog:n,onFinishButtonClick:a,isSelectTagsFromListDialogOpen:s,isSetPeriodDialogOpen:l,isSelectTagsFromPageDialogOpen:c,onCloseSetPeriodDialog:o,onDateRangeChange:i,onCloseSelectTagsFromPageDialog:r}=e;return v().createPortal(f().createElement(k.Provider,{store:Z},f().createElement(Ve,{userSettings:t},f().createElement(Te,{isOpen:s,onRequestClose:n,onFinishButtonClick:a}),f().createElement(we,{isOpen:l,onRequestClose:o,onDateRangeChange:i}),f().createElement(Qe,{isOpen:c,onRequestClose:r,onFinish:a}))),document.body)};Ye.defaultProps={isSelectTagsFromListDialogOpen:!1,isSelectTagsFromPageDialogOpen:!1,isSetPeriodDialogOpen:!1};const Xe=Ye;class et extends s.ReactWidget{constructor(e,t,n,a,s,l){super(),this.toggleSelectTagsFromListDialogSignal=e,this.injectDataToNoteBookSignal=t,this.toggleSetPeriodDialog=n,this.setDateRangeSignal=a,this.toggleSelectTagsFromPageDialogSignal=s,this.updateUserSettingsSignal=l,this.onInFinishButtonClick=e=>{this.injectDataToNoteBookSignal.emit(e),this.toggleSelectTagsFromListDialogSignal.emit(!1)},this.onDateRangeChange=e=>{this.setDateRangeSignal.emit(e),this.toggleSetPeriodDialog.emit(!1)},this.onCloseSelectTagsFromListDialog=()=>{this.toggleSelectTagsFromListDialogSignal.emit(!1)},this.onCloseSetPeriodDialog=()=>this.toggleSetPeriodDialog.emit(!1),this.onCloseSelectTagsFromPageDialog=()=>{this.toggleSelectTagsFromPageDialogSignal.emit(!1)}}render(){return f().createElement(s.UseSignal,{signal:this.toggleSelectTagsFromListDialogSignal,initialArgs:!1},((e,t)=>f().createElement(s.UseSignal,{signal:this.toggleSetPeriodDialog,initialArgs:!1},((e,n)=>f().createElement(s.UseSignal,{signal:this.toggleSelectTagsFromPageDialogSignal,initialArgs:!1},((e,a)=>f().createElement(s.UseSignal,{signal:this.updateUserSettingsSignal},((e,s)=>f().createElement(Xe,{isSelectTagsFromListDialogOpen:t,isSelectTagsFromPageDialogOpen:a,isSetPeriodDialogOpen:n,userSettings:s,onFinishButtonClick:this.onInFinishButtonClick,onCloseSelectTagsFromListDialog:this.onCloseSelectTagsFromListDialog,onCloseSetPeriodDialog:this.onCloseSetPeriodDialog,onDateRangeChange:this.onDateRangeChange,onCloseSelectTagsFromPageDialog:this.onCloseSelectTagsFromPageDialog})))))))))}}const tt=new q.LabIcon({name:"hmi_manager:addTags",svgstr:"<svg viewBox='0 0 23 21' xmlns='http://www.w3.org/2000/svg'>\n    <g stroke='none' stroke-width='1' fill='none' fill-rule='evenodd'>\n        <g class='jp-icon3' transform='translate(-1266.000000, -366.000000)' fill='#000000' fill-rule='nonzero'>\n            <g class='jp-icon3' fill='currentColor' transform='translate(1265.000000, 364.000000)'>\n                <path d='M19,9.06189375 L19,5.07070707 L3,5.07070707 L3,19 L10,19 L10,21 L3.25,21 C2.0073125,21 1,19.8741444 1,18.4853148 L1,4.51475556 C1,3.12585556 2.0073125,2 3.25,2 L18.75,2 C19.9926875,2 21,3.12585556 21,4.51475556 L21,9.58151705 C20.3693038,9.3262177 19.6986401,9.14901294 19,9.06189375 Z M6.5,7.58825185 L6.5,8.70587407 L7.6,8.70587407 L7.6,7.58825185 L6.5,7.58825185 Z M4.3,7.58825185 L4.3,8.70587407 L5.4,8.70587407 L5.4,7.58825185 L4.3,7.58825185 Z M5.7,14.2941963 L5.7,16.5293704 L7.7,16.5293704 L7.7,14.2941963 L5.7,14.2941963 Z M4.3,9.82356667 L4.3,13.1765037 L8.8,13.1765037 L8.8,9.82356667 L4.3,9.82356667 Z M10.3296213,14.2941963 C10.1153347,14.9916046 10,15.7323334 10,16.5 C10,16.8900239 10.0297712,17.2730944 10.0871652,17.647063 L8.8,17.647063 L8.8,14.2941963 L10.3296213,14.2941963 Z M17.5,9 C17.1954183,9 16.8950773,9.01815608 16.6,9.05344499 L16.6,8.70587407 L14.4,8.70587407 L14.4,9.66863434 C12.8246897,10.3846342 11.5406772,11.6295099 10.7747201,13.1765037 L9.9,13.1765037 L9.9,7.58825185 L17.5,7.58825185 L17.5,9 Z'></path>\n                <path d='M12.0051139,16.75 C12.1361784,13.5522295 14.7700366,11 18,11 C21.3137085,11 24,13.6862915 24,17 C24,20.2299634 21.4477705,22.8638216 18.25,22.9948861 L18.25,23 L12,23 L12,16.75 L12.0051139,16.75 Z M18,21.75 C20.6233526,21.75 22.75,19.6233526 22.75,17 C22.75,14.3766474 20.6233526,12.25 18,12.25 C15.3766474,12.25 13.25,14.3766474 13.25,17 C13.25,19.6233526 15.3766474,21.75 18,21.75 Z M18.75,16.25 L21,16.25 L21,17.75 L18.75,17.75 L18.75,20 L17.25,20 L17.25,17.75 L15,17.75 L15,16.25 L17.25,16.25 L17.25,14 L18.75,14 L18.75,16.25 Z'></path>\n            </g>\n        </g>\n    </g>\n</svg>\n"}),nt=new q.LabIcon({name:"hmi_manager:date_range",svgstr:'\n    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">\n      <path d="M0 0h24v24H0z" fill="none"/>\n      <path class="jp-icon3" d="M9 11H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2zm2-7h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V9h14v11z" fill="#616161"/>\n    </svg>'}),at=new q.LabIcon({name:"hmi_manager:selectTagsFromPage",svgstr:'<svg viewBox="0 0 18 18" xmlns="http://www.w3.org/2000/svg">\n    <g stroke="none" stroke-width="1" fill-rule="evenodd">\n        <g transform="translate(-1086.000000, -479.000000)">\n            <g transform="translate(1084.000000, 477.000000)">\n                <path d="M12.03125,9.96875 L15.125,9.96875 L15.125,12.03125 L12.03125,12.03125 L12.03125,15.125 L9.96875,15.125 L9.96875,12.03125 L6.875,12.03125 L6.875,9.96875 L9.96875,9.96875 L9.96875,6.875 L12.03125,6.875 L12.03125,9.96875 Z M2.75703161,10.65625 C2.93724533,6.25931559 6.55880038,2.75 11,2.75 C15.5563492,2.75 19.25,6.44365081 19.25,11 C19.25,15.4411996 15.7406844,19.0627547 11.34375,19.2429684 L11.34375,19.25 L2.75,19.25 L2.75,10.65625 L2.75703161,10.65625 Z M11,17.53125 C14.6071098,17.53125 17.53125,14.6071098 17.53125,11 C17.53125,7.39289023 14.6071098,4.46875 11,4.46875 C7.39289023,4.46875 4.46875,7.39289023 4.46875,11 C4.46875,14.6071098 7.39289023,17.53125 11,17.53125 Z" class="jp-icon3" fill="none"></path>\n            </g>\n        </g>\n    </g>\n</svg>\n'}),st="energy_machines_jupyter_reports:settings",lt={requires:[i.ISettingRegistry],activate:function(e,t){const n=new ot;e.docRegistry.addWidgetExtension("Notebook",n),t.pluginChanged.connect(((e,t)=>{t===st&&e.load(st).then((e=>{ct.emit({domain:e.get("domain").composite||"",accessToken:e.get("accessToken").composite||""})}))})),Promise.all([e.restored,t.load(st)]).then((([,e])=>{ct.emit({domain:e.get("domain").composite||"",accessToken:e.get("accessToken").composite||""})})),ct.connect(((e,t)=>{n.setSettings(t)}))},id:st,autoStart:!0},ct=new c.Signal({});class ot{createNew(e,t){let n=new c.Signal(this),i=new c.Signal(this),g=new c.Signal(this),m=new c.Signal(this),h=new c.Signal(this);const p=e.content,_=new et(n,i,g,m,h,ct),f=t.model;i.connect(((e,n)=>{L(f,((e,t,n)=>{const{projects:a}=t;let s=null;if(a.length){const l=["import requests"];l.push(`\nheaders = {'Content-Type': 'application/json','Authorization': 'Bearer ${n.accessToken}' }`);const c={};a.forEach((e=>{const n=t.tags[e.id],a=d(`${e.name}_tags_history`);l.push(`${a} = requests.post('${u()}/api/v1/${e.id}/history/aggregate/by-path/json', headers=headers, json = {\n        "groupingType": "MINUTES",\n        "tagList": [${n.map((e=>`'${e}'`))}],\n        "timeFrom": time_from,\n        "timeTo": time_to\n      }).json()`),c[e.id]=n.map(((t,n)=>`${d(`${e.name}_${t}_history`)} = ${a}[${[n]}]`))})),a.forEach((e=>{l.push(`\n# ${e.name} tags history variables`),c[e.id].forEach((e=>l.push(e)))})),s=C({notebookModel:e,source:l,id:E.HISTORY_REQUEST})}return s})(f,n,this.settings),E.HISTORY_REQUEST),l.NotebookActions.runAll(p,t.sessionContext)})),m.connect(((e,n)=>{L(f,((e,{startDate:t,endDate:n})=>{const a=[];return a.push(`time_from = ${t.valueOf()} # ${(0,r.default)(t,S)}`),a.push(`time_to = ${n.valueOf()} # ${(0,r.default)(n,S)}`),C({notebookModel:e,source:a,id:E.PERIOD})})(f,n),E.PERIOD),l.NotebookActions.runAll(p,t.sessionContext)}));const T=new s.ToolbarButton({icon:tt,onClick:()=>{n.emit(!0)},tooltip:"Select tags from list"}),v=new s.ToolbarButton({icon:nt,onClick:()=>{g.emit(!0)},tooltip:"Edit or set period"}),k=new s.ToolbarButton({icon:at,onClick:()=>{h.emit(!0)},tooltip:"Select tags from page"});return o.Widget.attach(_,document.body),e.toolbar.insertItem(0,"select-tags-from-page",k),e.toolbar.insertItem(0,"edit-or-set-period",v),e.toolbar.insertItem(0,"select-tags",T),new a.DisposableDelegate((()=>{_.dispose(),T.dispose(),v.dispose(),k.dispose(),n=null,i=null,g=null,m=null,h=null}))}setSettings(e){this.settings=e}}const it=lt}}]);