import{s as c,v as o,l as r,a as _}from"./map-b944464c.js";import"./main-214e2e5c.js";import"./proj-3e4e3ac0.js";import"./constants-9b7da064.js";let l=!1;async function y(){for(;l===!1;)await new Promise(e=>setTimeout(e,50))}const m={mmsi:"MMSI",imo:"IMO",vessel_name:"Name",vessel_name2:"Name",flag:"Flag",ship_type_txt:"Type",vesseltype_generic:"Type",vesseltype_detailed:"Details",length_breadth:"Size",year_built:"Year",summer_dwt:"Summer DWT",gross_tonnage:"Gross Tonnage"};function d(e){let i="";for(const t in m){const a=e[t];a===""||t.includes("dim_")||t==="ship_type"||t==="vessel_name"&&"vessel_name2"in e||t==="ship_type_txt"&&"vesseltype_generic"in e&&e.vesseltype_generic!=="-"||(a==="0"||a===0)&&t!=="mmsi"||t==="msgtype"||a===void 0||a==="-"||(i=`${i}${m[t]}: ${a}<br>`)}e.meta_string=i,o[e.mmsi]=e;let n=r.getFeatureById(e.mmsi);return n!==null&&_(n),e}const s=new WebSocket(c);s.addEventListener("message",async e=>{const i=await e.data.text(),n=JSON.parse(i);switch(n.msgtype){case"vesselinfo":{const t=d(n);o[t.mmsi]=t;break}case"doneMetadata":{l=!0,s.close();break}}});s.onerror=()=>{s.close()};s.onopen=async e=>{await s.send(JSON.stringify({msgtype:"meta"})),await y(),s.close()};
