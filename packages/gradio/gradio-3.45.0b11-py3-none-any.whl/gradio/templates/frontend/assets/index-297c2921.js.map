{"version":3,"file":"index-297c2921.js","sources":["../../../../js/model3D/interactive/Model3DUpload.svelte","../../../../js/model3D/interactive/InteractiveModel3d.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher, tick, onMount } from \"svelte\";\n\timport { Upload, ModifyUpload } from \"@gradio/upload\";\n\timport type { FileData } from \"@gradio/upload\";\n\timport { BlockLabel } from \"@gradio/atoms\";\n\timport { File } from \"@gradio/icons\";\n\timport { add_new_model, reset_camera_position } from \"../shared/utils\";\n\n\texport let value: null | FileData;\n\texport let clear_color: [number, number, number, number] = [0, 0, 0, 0];\n\texport let label = \"\";\n\texport let show_label: boolean;\n\texport let root: string;\n\texport let i18n: I18nFormatter;\n\texport let zoom_speed = 1;\n\n\t// alpha, beta, radius\n\texport let camera_position: [number | null, number | null, number | null] = [\n\t\tnull,\n\t\tnull,\n\t\tnull\n\t];\n\n\tlet mounted = false;\n\tlet canvas: HTMLCanvasElement;\n\tlet scene: BABYLON.Scene;\n\tlet engine: BABYLON.Engine;\n\n\tfunction reset_scene(): void {\n\t\tscene = add_new_model(\n\t\t\tcanvas,\n\t\t\tscene,\n\t\t\tengine,\n\t\t\tvalue,\n\t\t\tclear_color,\n\t\t\tcamera_position,\n\t\t\tzoom_speed\n\t\t);\n\t}\n\n\tonMount(() => {\n\t\tif (value != null) {\n\t\t\treset_scene();\n\t\t}\n\t\tmounted = true;\n\t});\n\n\t$: ({ data, is_file, name } = value || {\n\t\tdata: undefined,\n\t\tis_file: undefined,\n\t\tname: undefined\n\t});\n\n\t$: canvas && mounted && data != null && is_file && reset_scene();\n\n\tasync function handle_upload({\n\t\tdetail\n\t}: CustomEvent<FileData>): Promise<void> {\n\t\tvalue = detail;\n\t\tawait tick();\n\t\treset_scene();\n\t\tdispatch(\"change\", value);\n\t}\n\n\tasync function handle_clear(): Promise<void> {\n\t\tif (scene && engine) {\n\t\t\tscene.dispose();\n\t\t\tengine.dispose();\n\t\t}\n\t\tvalue = null;\n\t\tawait tick();\n\t\tdispatch(\"clear\");\n\t}\n\n\tasync function handle_undo(): Promise<void> {\n\t\treset_camera_position(scene, camera_position, zoom_speed);\n\t}\n\n\tconst dispatch = createEventDispatcher<{\n\t\tchange: FileData | null;\n\t\tclear: undefined;\n\t\tdrag: boolean;\n\t}>();\n\n\tlet dragging = false;\n\n\timport * as BABYLON from \"babylonjs\";\n\timport * as BABYLON_LOADERS from \"babylonjs-loaders\";\n\timport type { I18nFormatter } from \"js/utils/src\";\n\n\tBABYLON_LOADERS.OBJFileLoader.IMPORT_VERTEX_COLORS = true;\n\n\t$: dispatch(\"drag\", dragging);\n</script>\n\n<BlockLabel {show_label} Icon={File} label={label || \"3D Model\"} />\n\n{#if value === null}\n\t<Upload\n\t\ton:load={handle_upload}\n\t\t{root}\n\t\tfiletype=\".obj, .gltf, .glb\"\n\t\tbind:dragging\n\t>\n\t\t<slot />\n\t</Upload>\n{:else}\n\t<div class=\"input-model\">\n\t\t<ModifyUpload\n\t\t\tundoable\n\t\t\ton:clear={handle_clear}\n\t\t\t{i18n}\n\t\t\ton:undo={handle_undo}\n\t\t\tabsolute\n\t\t/>\n\t\t<canvas bind:this={canvas} />\n\t</div>\n{/if}\n\n<style>\n\t.input-model {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\tcanvas {\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t\tobject-fit: contain;\n\t\toverflow: hidden;\n\t}\n</style>\n","<script lang=\"ts\">\n\timport type { Gradio } from \"@gradio/utils\";\n\timport type { FileData } from \"@gradio/upload\";\n\timport { normalise_file } from \"@gradio/upload\";\n\timport Model3DUpload from \"./Model3DUpload.svelte\";\n\timport { Block, UploadText } from \"@gradio/atoms\";\n\n\timport { StatusTracker } from \"@gradio/statustracker\";\n\timport type { LoadingStatus } from \"@gradio/statustracker\";\n\n\texport let elem_id = \"\";\n\texport let elem_classes: string[] = [];\n\texport let visible = true;\n\texport let value: null | FileData = null;\n\texport let root: string;\n\texport let root_url: null | string;\n\texport let clear_color: [number, number, number, number];\n\texport let loading_status: LoadingStatus;\n\texport let label: string;\n\texport let show_label: boolean;\n\texport let container = true;\n\texport let scale: number | null = null;\n\texport let min_width: number | undefined = undefined;\n\texport let gradio: Gradio<{\n\t\tchange: typeof value;\n\t\tclear: never;\n\t}>;\n\texport let zoom_speed = 1;\n\texport let height: number | undefined = undefined;\n\n\t// alpha, beta, radius\n\texport let camera_position: [number | null, number | null, number | null] = [\n\t\tnull,\n\t\tnull,\n\t\tnull\n\t];\n\n\tlet _value: null | FileData;\n\t$: _value = normalise_file(value, root, root_url);\n\n\tlet dragging = false;\n</script>\n\n<Block\n\t{visible}\n\tvariant={value === null ? \"dashed\" : \"solid\"}\n\tborder_mode={dragging ? \"focus\" : \"base\"}\n\tpadding={false}\n\t{elem_id}\n\t{elem_classes}\n\t{container}\n\t{scale}\n\t{min_width}\n\t{height}\n>\n\t<StatusTracker\n\t\tautoscroll={gradio.autoscroll}\n\t\ti18n={gradio.i18n}\n\t\t{...loading_status}\n\t/>\n\n\t<Model3DUpload\n\t\t{label}\n\t\t{show_label}\n\t\t{root}\n\t\t{clear_color}\n\t\tvalue={_value}\n\t\t{camera_position}\n\t\t{zoom_speed}\n\t\ton:change={({ detail }) => (value = detail)}\n\t\ton:drag={({ detail }) => (dragging = detail)}\n\t\ton:change={({ detail }) => gradio.dispatch(\"change\", detail)}\n\t\ton:clear={() => gradio.dispatch(\"clear\")}\n\t\ti18n={gradio.i18n}\n\t>\n\t\t<UploadText i18n={gradio.i18n} type=\"file\" />\n\t</Model3DUpload>\n</Block>\n"],"names":["ctx","insert","target","div","anchor","append","canvas_1","File","dirty","blocklabel_changes","value","$$props","clear_color","label","show_label","root","i18n","zoom_speed","camera_position","mounted","canvas","scene","engine","reset_scene","add_new_model","onMount","$$invalidate","handle_upload","detail","tick","dispatch","handle_clear","handle_undo","reset_camera_position","createEventDispatcher","dragging","BABYLON_LOADERS.OBJFileLoader","$$value","data","is_file","name","uploadtext_changes","model3dupload_changes","block_changes","elem_id","elem_classes","visible","root_url","loading_status","container","scale","min_width","gradio","height","_value","change_handler_1","normalise_file"],"mappings":"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"}