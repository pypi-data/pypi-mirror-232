# Generated by Django 2.2.28 on 2023-05-02 07:40

from django.conf import settings
from django.db import migrations

def update_usernames(apps, schema_editor):
    if not schema_editor.connection.vendor.startswith('postgres'):
        return
    schema_editor.execute("UPDATE djangoldp_account_ldpuser SET username = gen_random_uuid() WHERE username LIKE '%_%'", params=None)
    schema_editor.execute("UPDATE djangoldp_account_ldpuser SET urlid = '" + getattr(settings, 'BASE_URL') + "' || '/users/' || username || '/'")
    schema_editor.execute("UPDATE djangoldp_account_ldpuser SET slug = lower(username)")

class Migration(migrations.Migration):

    dependencies = [
        ('djangoldp_needle', '0032_avatar'),
    ]

    operations = [
        migrations.RunPython(update_usernames),
    ]
