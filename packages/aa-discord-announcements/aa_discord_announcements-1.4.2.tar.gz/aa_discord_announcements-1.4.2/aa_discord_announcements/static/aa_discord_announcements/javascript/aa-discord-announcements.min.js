$(document).ready(()=>{"use strict";const selectAnnouncementTarget=$("select#id_announcement_target");const selectAnnouncementChannel=$("select#id_announcement_channel");const inputCsrfMiddlewareToken=$('input[name="csrfmiddlewaretoken"]');const inputAnnouncementText=$('textarea[name="announcement_text"]');const announcementForm=$("#aa-discord-announcements-form");const getAnnouncementTargetsForCurrentUser=()=>{$.ajax({url:discordAnnouncementsSettings.url.getAnnouncementTargets,success:data=>{$(selectAnnouncementTarget).html(data)}})};const getWebhooksForCurrentUser=()=>{$.ajax({url:discordAnnouncementsSettings.url.getAnnouncementWebhooks,success:data=>{$(selectAnnouncementChannel).html(data)}})};const closeMessageElement=(element,closeAfter=10)=>{$(element).fadeTo(closeAfter*1e3,500).slideUp(500,elm=>{$(elm).slideUp(500,el=>{$(el).remove()})})};const showSuccess=(message,element)=>{$(element).html('<div class="alert alert-success alert-dismissable alert-message-success">'+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeMessageElement(".alert-message-success")};const showError=(message,element)=>{$(element).html('<div class="alert alert-danger alert-dismissable alert-message-error">'+'<button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>'+message+"</div>");closeMessageElement(".alert-message-error",9999)};const copyAnnouncementText=()=>{const clipboardFleetPingData=new ClipboardJS("button#copyDiscordAnnouncement");clipboardFleetPingData.on("success",e=>{showSuccess(discordAnnouncementsTranslations.copyToClipboard.success,".aa-discord-announcements-announcement-copyresult");e.clearSelection();clipboardFleetPingData.destroy()});clipboardFleetPingData.on("error",()=>{showError(discordAnnouncementsTranslations.copyToClipboard.error,".aa-discord-announcements-announcement-copyresult");clipboardFleetPingData.destroy()})};announcementForm.submit(event=>{event.preventDefault();$(".aa-discord-announcements-form-message div").remove();const announcementFormMandatoryFields=[inputAnnouncementText.val()];if(announcementFormMandatoryFields.includes("")){showError(discordAnnouncementsTranslations.error.missingFields,".aa-discord-announcements-form-message");return false}const formData=announcementForm.serializeArray().reduce((obj,item)=>{obj[item.name]=item.value;return obj},{});$.ajax({url:discordAnnouncementsSettings.url.createAnnouncement,type:"post",data:formData,headers:{"X-CSRFToken":inputCsrfMiddlewareToken.val()},success:data=>{if(data.success===true){$(".aa-discord-announcements-no-announcement").hide("fast");$(".aa-discord-announcements-announcement").show("fast");$(".aa-discord-announcements-announcement-text").html(data.announcement_context);if(data.message){showSuccess(data.message,".aa-discord-announcements-form-message")}}else{if(data.message){showError(data.message,".aa-discord-announcements-form-message")}else{showError("Something went wrong, no details given.",".aa-discord-announcements-form-message")}}}})});$("button#copyDiscordAnnouncement").on("click",()=>{copyAnnouncementText()});(()=>{getAnnouncementTargetsForCurrentUser();getWebhooksForCurrentUser()})()});