# Built from template located at:
# https://gitlab.com/gitlab-org/gitlab/-/blob/master/lib/gitlab/ci/templates/Python.gitlab-ci.yml

variables:
    # Change pip's cache directory to be inside the project directory.
    PIP_CACHE_DIR: "$CI_PROJECT_DIR/.cache/pip"

default:
    cache:
        paths:
            - .cache/pip

    before_script:
        - apt-get update -yq && apt-get install -yq curl ffmpeg pulseaudio
        - pulseaudio --verbose --daemonize=yes
        - python --version    # For debugging.
        - python -m pip install psutil

.unittest-scripts: &unittest-scripts
    - python -m unittest --verbose --failfast

.coverage-scripts: &coverage-scripts
    - python -m pip install coverage
    - python -m coverage run -m unittest
    - python -m coverage report --show-missing

py38:
    image: python:3.8
    stage: test
    script:
        - *unittest-scripts

py39:
    image: python:3.9
    stage: test
    script:
        - *unittest-scripts

py310:
    image: python:3.10
    stage: test
    script:
        - *unittest-scripts

py311:
    image: python:3.11
    stage: test
    script:
        - *unittest-scripts
        - *coverage-scripts
    coverage: '/TOTAL.* (100\%|\d?\d\%)$/'
